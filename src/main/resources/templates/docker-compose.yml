services:
  app:
    image: ${BASE_IMAGE}
    container_name: ${CONTAINER_NAME}
    command: ${START_COMMAND}
    ports:
      # 注意：对于nginx等使用80端口的镜像，需要映射到80
      # 对于Java/Node等使用动态端口的，映射到${APP_PORT}
      - "${APP_PORT}:${CONTAINER_PORT}"
    volumes:
      # 根据镜像类型调整挂载路径：
      # nginx: /usr/share/nginx/html (只读)
      # java/node/python: /app/program (可写，支持安装依赖)
      - ${PROGRAM_PATH}:${VOLUME_MOUNT_PATH}${VOLUME_MOUNT_OPTIONS}
      - ${LOG_PATH}:/app/logs
    environment:
      - APP_PORT=${APP_PORT}
      - CONTAINER_PORT=${CONTAINER_PORT}
      - USER_ID=${USER_ID}
      - EXP_ID=${EXP_ID}
      - ENV_ID=${ENV_ID}
    networks:
      - ${NETWORK_NAME}
${SHARED_MYSQL_NETWORK}
    restart: unless-stopped
${MYSQL_DEPENDS_ON}
    healthcheck:
      # 根据镜像类型调整健康检查：
      # nginx: wget http://localhost/
      # java/node: curl http://localhost:${APP_PORT}/health
      test: ${HEALTHCHECK_TEST}
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: ${HEALTHCHECK_START_PERIOD}
networks:
  ${NETWORK_NAME}:
    driver: bridge
${SHARED_MYSQL_NETWORK_DEF}

${MYSQL_VOLUME}

